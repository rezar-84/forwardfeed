!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.linkit=e())}(self,()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};return(()=>{"use strict";i.d(n,{default:()=>d});var t=i("ckeditor5/src/core.js"),e=i("ckeditor5/src/typing.js");function s(t){if(null==t)return null;const e=String(t).trim().split(".")[0].match(/\d+/);return e?Number(e[0]):null}class o extends t.Plugin{init(){this.attrs=["linkDataEntityType","linkDataEntityUuid","linkDataEntitySubstitution"],this.attrsView=["data-entity-type","data-entity-uuid","data-entity-substitution"],this._allowAndConvertExtraAttributes(),this._removeExtraAttributesOnUnlinkCommandExecute(),this._refreshExtraAttributeValues(),this._addExtraAttributesOnLinkCommandExecute()}_allowAndConvertExtraAttributes(){const t=this.editor;t.model.schema.extend("$text",{allowAttributes:this.attrs}),this.attrs.forEach((e,i)=>{t.conversion.for("downcast").attributeToElement({model:e,view:(t,{writer:e})=>{const n=e.createAttributeElement("a",{[this.attrsView[i]]:t},{priority:5});return e.setCustomProperty("link",!0,n),n}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{[this.attrsView[i]]:!0}},model:{key:e,value:t=>t.getAttribute(this.attrsView[i])}})})}_addExtraAttributesOnLinkCommandExecute(){const t=this.editor,i=t.commands.get("link");let n=!1;i.on("execute",(i,o)=>{if(n)return void(n=!1);i.stop(),n=!0;let r=[];o&&o[1]&&!o[1].linkit_attributes?(this.attrs.forEach(t=>{r[t]=i.source[t]}),o[1].linkit_attributes=r):r=o[1].linkit_attributes,o[1].linkit_attributes=r;const a=r,l=this.editor.model,u=l.document.selection,d=o[o.length-1]||o[1].linkit_attributes.displayedText,c=o[0];l.change(i=>{const n=(t,e)=>{this.attrs.forEach(n=>{if(a[n]?i.setAttribute(n,a[n],t):i.removeAttribute(n,t),e){i.setSelection(t.end);const{plugins:e}=this.editor;e.has("TwoStepCaretMovement")&&s(CKEDITOR_VERSION)>=45?e.get("TwoStepCaretMovement")._handleForwardMovement():i.removeSelectionAttribute(n)}})};if(t.execute("link",...o),u.isCollapsed){let t=function(t,i,n){const s=i.getFirstPosition();return(0,e.findAttributeRange)(s,"linkHref",n,t)}(l,u,c);if(!t)return;t=((t,e)=>{const n=function(t){let e="";for(const i of t.getItems()){if(!i.is("$text")&&!i.is("$textProxy"))return;e+=i.data}return e}(t);return n?(s(CKEDITOR_VERSION)<45&&"object"==typeof e&&(e=n),e||n||o[0],i.createRange(t.start,t.start.getShiftedBy(n.length))):t})(t,d),n(t,!0)}else{const t=l.schema.getValidRanges(u.getRanges(),"linkDataEntityType");for(const e of t)n(e)}})},{priority:"high"})}_removeExtraAttributesOnUnlinkCommandExecute(){const t=this.editor,i=t.commands.get("unlink"),n=this.editor.model,s=n.document.selection;let o=!1;i.on("execute",i=>{o||(i.stop(),n.change(()=>{o=!0,t.execute("unlink"),o=!1,n.change(t=>{let i;this.attrs.forEach(o=>{i=s.isCollapsed?[(0,e.findAttributeRange)(s.getFirstPosition(),o,s.getAttribute(o),n)]:n.schema.getValidRanges(s.getRanges(),o);for(const e of i)t.removeAttribute(o,e)})})}))},{priority:"high"})}_refreshExtraAttributeValues(){const t=this.editor,e=this.attrs,i=t.commands.get("link"),n=this.editor.model,s=n.document.selection;e.forEach(t=>{i.set(t,null)}),n.document.on("change",()=>{e.forEach(t=>{i[t]=s.getAttribute(t)})})}static get pluginName(){return"LinkitEditing"}}const r=jQuery;function a(t,e){var i=r("<li>").addClass("linkit-result-line"),n=r("<div>").addClass("linkit-result-line-wrapper");return n.addClass(e.status),n.append(r("<span>").html(e.label).addClass("linkit-result-line--title")),e.hasOwnProperty("description")&&n.append(r("<span>").html(e.description).addClass("linkit-result-line--description")),i.append(n).appendTo(t)}function l(t,e){var i=this.element.autocomplete("instance"),n={};e.forEach(function(t){const e=t.hasOwnProperty("group")?t.group:"";n.hasOwnProperty(e)||(n[e]=[]),n[e].push(t)}),r.each(n,function(e,n){e.length&&t.append('<li class="linkit-result-line--group ui-menu-divider">'+e+"</li>"),r.each(n,function(e,n){i._renderItemData(t,n)})})}class u extends t.Plugin{static get requires(){return[o]}init(){this._state={};const t=this.editor;t.config.get("linkit");t.plugins.get("LinkUI")._createViews(),this._enableLinkAutocomplete(),this._handleExtraFormFieldSubmit(),this._handleDataLoadingIntoExtraFormField()}_enableLinkAutocomplete(){const t=this.editor,e=t.config.get("linkit"),i=t.plugins.get("LinkUI").formView,n=i.urlInputView.fieldView.element;let s=!1;i.extendTemplate({attributes:{class:["ck-vertical-form","ck-link-form_layout-vertical"]}}),t.plugins.get("ContextualBalloon").on("set:visibleView",(t,o,u,d)=>{if(u!==i||s)return;let c;!function(t,e){const{autocompleteUrl:i,selectHandler:n,closeHandler:s,openHandler:o}=e,u={cache:{},ajax:{dataType:"json",jsonp:!1}},d={appendTo:t.closest(".ck-labeled-field-view"),source:function(t,e){const{cache:n}=u;var s=t.term;n.hasOwnProperty(s)?e(n[s]):r.ajax(i,{success:function(t){n[s]=t.suggestions,e(t.suggestions)},data:{q:s},...u.ajax})},select:n,focus:()=>!1,search:()=>!d.isComposing,close:s,open:o,minLength:1,isComposing:!1},c=r(t).autocomplete(d),p=c.data("ui-autocomplete");p.widget().menu("option","items","> :not(.linkit-result-line--group)"),p._renderMenu=l,p._renderItem=a,c.autocomplete("widget").addClass("linkit-ui-autocomplete ck-reset_all-excluded"),c.on("click",function(){c.autocomplete("search",c.val())}),c.on("compositionstart.autocomplete",function(){d.isComposing=!0}),c.on("compositionend.autocomplete",function(){d.isComposing=!1})}(n,{...e,selectHandler:(t,{item:e})=>{if(!e.path)throw"Missing path param."+JSON.stringify(e);if(e.entity_type_id||e.entity_uuid||e.substitution_id){if(!e.entity_type_id||!e.entity_uuid||!e.substitution_id)throw"Missing path param."+JSON.stringify(e);this.set("entityType",e.entity_type_id),this.set("entityUuid",e.entity_uuid),this.set("entitySubstitution",e.substitution_id)}else this.set("entityType",""),this.set("entityUuid",""),this.set("entitySubstitution","");if(i.hasOwnProperty("displayedTextInputView")&&""===i.displayedTextInputView.fieldView.element.value&&e.label&&!i.displayedTextInputView.fieldView.element.readOnly){const t=document.createElement("span");t.innerHTML=e.label,i.displayedTextInputView.fieldView.value=t.textContent}return t.target.value=e.path??"",c=!0,!1},openHandler:t=>{c=!1},closeHandler:t=>{c=!1}}),s=!0,i.urlInputView.fieldView.template.attributes.class.push("form-linkit-autocomplete")})}_handleExtraFormFieldSubmit(){const t=this.editor,e=t.plugins.get("LinkUI").formView,i=t.commands.get("link");t.plugins.get("Linkit");this.listenTo(e,"submit",()=>{i.once("execute",(t,i)=>{let n="";void 0!==e.displayedTextInputView&&(n=e.displayedTextInputView.fieldView.element.value),this._isValidHttpUrl(i[0])?i[1].linkit_attributes={displayedText:n}:i[1].linkit_attributes={linkDataEntityType:this.entityType,linkDataEntityUuid:this.entityUuid,linkDataEntitySubstitution:this.entitySubstitution,displayedText:n}},{priority:"highest"})},{priority:"high"})}_handleDataLoadingIntoExtraFormField(){const t=this.editor.commands.get("link");this.bind("entityType").to(t,"linkDataEntityType"),this.bind("entityUuid").to(t,"linkDataEntityUuid"),this.bind("entitySubstitution").to(t,"linkDataEntitySubstitution")}_isValidHttpUrl(t){let e;try{e=new URL(t)}catch(t){return!1}return"https:"===e.protocol}static get pluginName(){return"Linkit"}}const d={Linkit:u}})(),n=n.default})());